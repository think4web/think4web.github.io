---
published: true
layout: post
title: Конспект по GnuPG 
author: think4web
discription:
tags: gpg
---

## Опції конфігурації

Файл конфігурації GPG: ```~/.gnupg/gpg.conf```. Усі опції записуються без префікса ```--```.

```throw-keyids``` - не включати інформацію про ключ у зашифроване повідомлення. Опція може бути корисна для анонімазації отримувача повідомлення;

```no-emit-version``` - не вставляти версію GPG у зашифроване повідомлення;

```no-comments``` - прибирати коментарі з зашифрованого повідомлення.

## Опції команд

```--delete-key``` - видалити публічний ключ;

```--delete-secret-key``` - видлити приватний ключ. Приватний клюі можна видалити тільки після видалення публічного ключа з пари;

```--symmetric, -c``` - симетричне шифрування;

```--fingerprint``` - вивести відбиток ключа;

```--armor, -a``` - створює ASCII вивід, який можна вивісти на екран, відправити у месенджері або електронною поштою;

```--encrypt, -e``` - зашифрувати повідомлення;

```--recipient, -r``` - вказати ключ який буде використовуватися для шифрування;

```--default-recipient``` - вказати отримувача за замовченням;

```--default-recipient-self``` -

```--no-default-recipient``` - 

```--decrypt, -d``` - розшифрувати повідомлення;

```--sign, -s``` - підписати повідомлення, підпис буде знаходитись окремо від повідомлення;

```--clear-sign, --clearsign``` - підписати повідомлення, підпис буде збережений разом з повідомленням;

```--local-user, -u``` - вказувати ключ що буде використовуватись для підпису, схоже на опцію ```--recipient``` але не те саме;

```--verify``` - перевірити підпис;

```--list-keys, -k``` - показати список публічних ключів;

```--list-secret-keys, -K``` - показати список приватних ключів;

```--export``` - експортувати публічний ключ у файл;

```--import``` - імпортувати публічний ключ у зв'язку;

```--edit-key``` - редагувати ключ;

```--expert``` - експертний режим.

Для використання у скриптах у GPG є хороше API, що активується наступними опціями:

```--with-colons``` -

```--status-fd``` -

```--command-fd``` -

## Публікація ключив

Ключі відправлені на сервер публічних ключів неможливо видалити. Їх можливо тільки відкликати, що не видалить інформацію про них з серверу. 

Адресу серверу ключів можна додати у ```gpg.conf``` у рядку ```keyserver %URL%```.

Відправити публічний ключ **%KeyID** на сервер:

```bash
gpg --keyserver %URL% --send-keys %KeyID%
```

Отримати публічний ключ **%KeyID** з серверу:

```bash
gpg --keyserver %URL% --recv-keys %KeyID%
```

Оновити інформацію про ключі з серверу:

```bash
gpg --keyserver %URL% --refresh-keys
```

## Відкликання ключів

Створення сертифікату відкликання:

```bash
gpg -a --gen-revoke %KeyID% > %KeyID%.rev
```

Імпорт сертифікату відкликання до зв'язки ключів що відкличе відповідний ключ **%KeyID%**:

```bash
gpg --import %KeyID%.rev
```

Після цього залишається опублікувати ключі на сервері.

## Підписання ключів

Для підписання необхідно перейти до редагування ключа: ```gpg --edit-key %KeyID%```.

## Приклади

### Шифрування

Симетричне (**-c**) шифрування файлу ```test.txt``` паролем:

```bash
gpg -c test.txt
```
Команда створить шифрований файл ```test.txt.gpg```.

Симетричне (**-c**) шифрування (**-e**) файлу ```test.txt``` приватним ключем та паролем для користувача (**-r**) "**User Name**":

```bash
gpg -c -e -r 'User Name' test.txt
```

Розшифрувати файл можна буде ключем або паролем. Якщо у зв'язці буде присутній приватний ключі - для розшифровки програма запитає пароль від нього, якщо ні - програма запитає пароль яким шифрувався файл.

Асиметричне шифрування файлу ```test.txt``` публічним ключем для користувача (**-r**) "**User Name**":

```bash
gpg -e -r 'User Name' test.txt
```
Замість опції "**-r**" (ім'я адресату) можна використати опцію "**-R**" (```--hidden-recipient```), що приховає ім'я адресату. У протилежному випадку ім'я адресату можна буде подивитися не розшифровуючи файл.

```bash
gpg -e -R 'User Name' test.txt
```

За замовчуванням GPG створює шифровані вайли у бінарному форматі. Що значно зменшує розміри файлу у порівнянні з розміром до шифрування. Але зміст такого бінарного файлу неможливо копіювати і переслати без пошкоджень. Для передачи шифрованого файлу у вигляді тексту необхідно створити файл у форматі ASCII (**-a**):

```bash
gpg -e -a -r 'User Name' test.txt
```

Команда створить шифрований файл test.txt**.asc**, зміс якого можна переслати повідомленням або листом.

Шифрування повідомлення (%повідомлення%) у форматі ASCII (-a) для користувача "**User Name**":

```bash
echo '%повідомлення%' | gpg -e -a -r 'User Name'
```

Результат буде виведений у термінал, після чого його можна буде відправити повідомленням чи листом. Для виводу у файл (%назва_файлу%):

```bash
echo '%повідомлення%' | gpg -e -a -r 'User Name' > %назва_файлу%
```

### Розшифрування

Розшифрувати (-d) файл test.txt.gpg та вивести результат у термінал:

```bash
gpg -d test.txt.gpg
```

Розшифрувати (-d) файл test.txt.gpg та вивести результат у файл (-o) test.txt:

```bash
gpg -d -o test.txt test.txt.gpg
```

Або:

```bash
gpg -d test.txt.gpg > test.txt
```

Розшифрувати повідомлення та вивести результат у термінал:

```bash
'%текст_повідомлення%' | gpg -d
```

Розшифрувати текст з файлу test.txt.gpg і вивести результат у термінал:

```bash
cat test.txt.gpg | gpg -d
```

## Вивести інформацію про отримувача без розшифрування

Показати інформацію про отримувача файлу не розшифровуючи файл:

```bash
gpg --list-only -d test.txt.gpg
```

У випадку асиметричного шифрування для отримувача **User Name** з ключем **KeyID**:

```bash
gpg: encrypted with 2048-bit RSA key, ID %KeyID%, created 2020-02-22
      "User Name"
```

У випадку симетричного шифрування для користувача **User Name** з ключем **KeyID**:

```bash
gpg: AES encrypted session key
gpg: encrypted with 1 passphrase
gpg: encrypted with 2048-bit RSA key, ID %KeyID%, created 2020-02-22
      "User Name"
```

## Вказати приватний ключ для розшифрування

У зашифрованих GPG файлах та повідомленнях вказана інформація про отримувача (тобто про секретний ключ, яким можна розшифрувати), якщо отримувач прихований, програма буде просто перебирати наявні приватні ключі у спробі розшифрувати що їй вказали. Щоб явно вказати отримувача, ключ якого треба використовувати, застосовується опція ```--try-secret-key %User Name%```. Якщо ж інформація про отримувача підроблена, будь які спроби розшифрування зазнають невдачі. У такому випадку необхідно вказати опцію ```--try-all-secrets``` щоб програма GnuPG перебирала усі доступні приватні ключі не звертаючи уваги на ідентифікатор у шифрованому файлі чи повідомленні, як це відбувається коли отримувач не вказаний зовсім опціями ```--throw-keyids``` та ```--hidden-recipient```.

## Підписати файл 

Для підпису файлу використовується опція ```--sign``` або ```-s```. Якщо приватних ключей кілька, необхідно явно вказати потрібний опцією ```--local-user``` або ```-u```, що змінеть значення ключу за замовчуванням, опції ```--default-key```.

Підписати файл test.txt приватним ключем користувача **User Name**:

```bash
gpg -u 'User Name' -s test.txt
```

Команда створить новий файл test.txt.**gpg** у бінарному форматі, що буде містити і старий файл і підпис. Зміст бінарного файлу неможливо прочитати, скопіювати та переслати окремо від самого файлу.

Підписати у форматі ASCII (```--clear-sign```) файл test.txt приватним ключем користувача **User Name**:

```bash
gpg -u 'User Name' --clear-sign test.txt
```

Комадна створить новий файл test.txt.**asc**, що буде містити підпис та зміст старого файлу. Зміст підписаного файлу можна легко скопіювати та переслати окремо від самого файлу.

## Помилки


### Неможливо ввести пароль після помилки

Під час симетричного шифрування паролі кешуються щоб не потрібно було вводити один пароль багато разів. Але якщо ввести пароль не вірно і він потрапить у кеш, це викличе помилку при спробі розшифрування. Щоб виправити це треба вказати програмі що кеш використовувати не протрібно ```--no-symkey-cache```:

```bash
gpg -d --no-symkey-cache test.txt.gpg
```
